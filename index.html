<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <meta name="theme-color" content="#06c755" />
  <title>冠智的市調評估</title>

  <style>
    body {
      font-family: "Helvetica Neue", sans-serif;
      margin: 0;
      padding: 20px;
      background: #f2f2f2;
    }
    .overlay {
      max-width: 480px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 12px;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      box-sizing: border-box;
    }
    button {
      margin-top: 20px;
      padding: 10px;
      width: 100%;
      font-size: 16px;
      background: #06c755;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .qa-card {
      background: #f9f9f9;
      padding: 6px 8px;
      margin-top: 6px;
      font-size: 14px;
    }
    .result-container {
      max-width: 340px;
      margin: 0 auto;
    }
  </style>

  <!-- 截圖用工具 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
</head>

<body>
  <div class="overlay">
    <!-- === 基本資料 === -->
    <div id="basicInfoSection">
      <h1>冠智關心您－健檢問卷</h1>

      <label>姓名：</label>
      <input id="name" type="text" placeholder="例如 王小明" required />

      <label>聯絡電話：</label>
      <input id="phone" type="tel" placeholder="例如 0912345678" required />

      <label>Line ID：</label>
      <input id="lineId" type="text" placeholder="例如 myline123" required />

      <label>生日：</label>
      <input id="birthday" type="date" required />

      <button id="nextBtn" type="button">下一步</button>
    </div>

    <!-- === 問卷區塊 === -->
    <div id="questionSection" style="display:none">
      <div class="center-wrapper">
        <div id="jobSection">
          <label for="job">請選擇您的職業類別：</label>
          <select id="job">
            <option value="">請選擇</option>
            <option value="自營業者">自營業者</option>
            <option value="領導主管">領導主管</option>
            <option value="一般上班族">一般上班族</option>
            <option value="計程車司機">計程車司機</option>
            <option value="公職/醫療">公職/醫療</option>
          </select>
        </div>
        <form id="questionForm"></form>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const spinQuestions = {
        "一般上班族": [
          { q: "你現在做的這份工作穩定嗎？", options: ["穩定", "偶爾變動", "很不穩定"] },
          { q: "這份工作對你來說壓力大不大？", options: ["正常", "壓力大", "非常疲憊"] },
          { q: "你目前有固定在儲蓄嗎？還是存了就花？", options: ["有固定存","幾乎沒存"] },
          { q: "公司有提撥勞退，你還有另外規劃退休金嗎？", options: ["有額外規劃", "想規劃但還沒做", "沒有規劃"] },
          { q: "若突發大筆支出（家人生病醫療費等），你覺得夠用嗎？", options: ["可能夠", "完全沒有準備"] },
          { q: "退休後勞退每月2萬的生活費你覺得夠嗎？", options: ["應該夠用","還想更多"] },
          { q: "若裁員或生病無法上班幾個月，生活開銷有個備案嗎？", options: ["有一筆緊急避難金", "有想過但還沒準備"] },
          { q: "如果有個方式，可以每月幫你存一點，未來變成一筆退休補貼，或遇急用也能用，你覺得重要嗎？", options: ["重要", "還好"] },
          { q: "這種方式就像幫自己準備一個『備用電池』，你想了解嗎？", options: ["想了解", "觀望"] }
        ],
        "自營業者": [
          { q: "你目前生意穩定嗎？", options: ["穩定", "偶爾波動"] },
          { q: "你覺得當老闆一人多職辛苦嗎？", options: ["可接受", "略辛苦"] },
          { q: "你固定存錢？還是全部投入事業？", options: ["固定存錢", "少量存款", "全部投入"] },
          { q: "老闆沒有勞退，你有自主退休或投資規劃嗎？", options: ["部分有安排", "還沒有想過"] },
          { q: "店面修繕/突發大筆支出時，會有壓力感嗎？", options: ["可應付", "多少有壓力"] },
          { q: "你有沒有算過，未來退休後每月要花多少？", options: ["已估算並準備", "略擔心"] },
          { q: "如果哪天生病、不能工作幾個月，開銷有備案嗎？", options: ["部分準備", "還沒有準備"] },
          { q: "如果每月撥幾千塊，建立備用金，你覺得實用嗎？", options: [ "要看方案", "不需要"] },
          { q: "這像為自己生意準備保險，你會想了解嗎？", options: ["想了解", "再觀望"] }
        ],
        "領導主管": [
          { q: "你目前團隊工作量是否滿檔？", options: ["非常忙碌", "偶爾加班", "時間彈性"] },
          { q: "會不會犧牲掉自己與家人的時間？", options: ["常犧牲", "偶爾", "無影響"] },
          { q: "你現在有固定資產儲蓄嗎？", options: ["固定儲蓄", "部分儲蓄", "幾乎不存"] },
          { q: "若突然生病不能工作，財務有準備嗎？", options: ["部分準備", "沒準備"] },
          { q: "你覺得收入足夠支撐退休生活嗎？", options: ["足夠", "可能不足", "完全不擔心"] },
          { q: "目前資產配置有退休金計劃嗎？", options: ["有規劃", "沒有"] },
          { q: "是否考慮穩定現金流的資產？", options: ["已布局", "考慮中"] },
          { q: "如果有方式打造未來保障，你覺得有幫助嗎？", options: ["可以評估", "暫不需要"] },
          { q: "這就像為家庭建一道防線，你有興趣嗎？", options: ["想了解", "再觀望"] }
        ],
        "計程車司機": [
          { q: "您一天開幾小時？", options: ["12小時以上", "8到12小時", "少於8小時"] },
          { q: "收入是否波動？", options: ["很穩定", "稍有波動"] },
          { q: "平均月存多少？", options: ["超過2萬", "5000-1萬", "3000-5000"] },
          { q: "無法跑車時有其他收入嗎？", options: ["部分收入", "沒有"] },
          { q: "載客少時會不會吃緊？", options: ["晚點下班", "稍微吃緊"] },
          { q: "不能開車幾天收入中斷會影響嗎？", options: ["稍微影響","不影響"] },
          { q: "車子大修或突發開銷會緊張嗎？", options: ["能應付", "稍微擔心"] },
          { q: "如果準備預備基金，你覺得好加在嗎？", options: ["會覺得好險", "我不會車禍"] },
          { q: "這筆錢可當退休補貼，你會想了解嗎？", options: ["想了解", "可以考慮"] }
        ],
        "公職/醫療": [
          { q: "目前工作習慣嗎？", options: ["還行", "不太習慣"] },
          { q: "輪班影響健康或家庭嗎？", options: ["無影響", "些微影響"] },
          { q: "你有儲蓄或投資嗎？", options: ["少量儲蓄", "幾乎沒有"] },
          { q: "有額外退休金規劃嗎？", options: ["做過規劃", "正在考慮"] },
          { q: "突發支出你覺得現金流夠嗎？", options: ["足夠", "可能不足"] },
          { q: "退休後每月開銷夠嗎？", options: ["夠", "勉強夠"] },
          { q: "未來若無法工作，你有備案嗎？", options: ["有備案", "還沒想過"] },
          { q: "每月撥一筆補足缺口實用嗎？", options: ["可考慮", "還好"] },
          { q: "這像防護網，你會想了解嗎？", options: ["想了解", "再看看"] }
        ]
      };

      const $ = id => document.getElementById(id);
      const show = (id, f) => { $(id).style.display = f ? 'block' : 'none'; };

      const form = $('questionForm');
      const jobSel = $('job');

      $('nextBtn').addEventListener('click', () => {
        if (!($('name').value.trim() && $('phone').value.trim()
          && $('lineId').value.trim() && $('birthday').value)) {
          alert('請完整填寫所有基本資料！');
          return;
        }
        show('basicInfoSection', false);
        show('questionSection', true);
      });

      jobSel.addEventListener('change', () => jobSel.value && buildQuestions());

      function buildQuestions () {
        const qs = spinQuestions[jobSel.value] || [];
        form.innerHTML = '';
        qs.forEach((item, i) => {
          form.insertAdjacentHTML('beforeend', `<label>Q${i+1}. ${item.q}</label>`);
          item.options.forEach(opt => {
            form.insertAdjacentHTML('beforeend',
              `<div><input type="radio" name="q${i}" value="${opt}" required> ${opt}</div>`);
          });
        });
        const btn = document.createElement('button');
        btn.textContent = '開始評估';
        btn.type = 'button';
        btn.style.marginTop = '25px';
        btn.onclick = () => showResult(qs);
        form.appendChild(btn);
        form.scrollIntoView({ behavior: 'smooth' });
      }

      async function showResult(qs) {
        const ans = qs.map((_, i) => form.querySelector(`input[name="q${i}"]:checked`));
        const miss = ans.findIndex(a => !a);
        if (miss !== -1) return alert(`請回答第 ${miss + 1} 題！`);

        const jobSection = document.getElementById('jobSection');
        if (jobSection) jobSection.style.display = 'none';

        form.innerHTML = '';
        const box = document.createElement('div');
        box.className = 'result-container';

        box.innerHTML = `
          <p style="background:#fffae6;border:1px solid #f2c94c;
                    padding:10px;text-align:center;font-weight:600;
                    margin-bottom:15px;">
            請自行截圖此評估結果，傳送至 LINE 諮詢
          </p>`;

        const info = {
          name: $('name').value,
          phone: $('phone').value,
          line: $('lineId').value,
          bday: $('birthday').value,
          job: jobSel.value
        };

        box.insertAdjacentHTML('beforeend', `
          <table style="width:100%;border:1px solid #ddd;font-size:15px">
            <tr><th style="width:35%">姓名</th><td>${info.name}</td></tr>
            <tr><th>電話</th><td>${info.phone}</td></tr>
            <tr><th>Line ID</th><td>${info.line}</td></tr>
            <tr><th>生日</th><td>${info.bday}</td></tr>
            <tr><th>職業</th><td>${info.job}</td></tr>
          </table>`);

        qs.forEach((item, i) => {
          box.insertAdjacentHTML('beforeend', `
            <div class="qa-card">
              <div class="question">Q${i+1}. ${item.q}</div>
              <div class="answer">👉 ${ans[i].value}</div>
            </div>`);
        });

        form.appendChild(box);
        await html2canvas(box, { scale: 2 });

        const btnWrap = document.createElement('div');
        btnWrap.style.cssText = 'text-align:center;margin:20px 0;';

        const addUrl = `https://line.me/R/ti/p/%40637zzurf`;
        const lineA = document.createElement('a');
        lineA.textContent = 'LINE 諮詢';
        lineA.href = addUrl;
        lineA.target = '_blank';
        lineA.style.cssText = `
          display:inline-block;padding:8px 16px;font-size:15px;
          background:#06c755;color:#fff;border:none;border-radius:6px;
          cursor:pointer;text-decoration:none;`;

        lineA.addEventListener('click', e => {
          const ua = navigator.userAgent;
          const isIOS = /\(iP(hone|od|ad);/i.test(ua);
          const isAndroid = /\bAndroid\b/i.test(ua) && !/Windows/i.test(ua);
          const scheme = `line://ti/p/637zzurf`;
          if (isIOS || isAndroid) {
            e.preventDefault();
            location.href = scheme;
            setTimeout(() => location.href = addUrl, 800);
          }
        });

        btnWrap.append(lineA);
        box.insertBefore(btnWrap, box.children[1]);
        box.scrollIntoView({ behavior: 'smooth' });
      }
    });
  </script>
</body>
</html>
